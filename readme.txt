Version updates:

Improvements:
1. The new version of the code uses matlab struct (similar to dictionary) instead of matrix indexing. The readability of the code is much better and there is no need for the initEnv.m file for setting the global indexing variables.
2. Rewrote the dynamic grid algorithm, which is now cleaner.
3. Re-derived the theory. The entropic conditions are now documented in pdf. 
4. Added junction types onrampjunc, and offrampjunc, where onramp and offramps are controllable.
4. All array are defined as column vectors. 
5. Re-name functions and variables to make the code more readable and more precise, such as entropicSolutionAtJunc, sendingFuncAtLink, findBoundaryIntersection.
6. The original setIneqConstraints was developed in Java where index starts from 0 which is confusing in MATLAB. Modified all indexing in matlab which now starts from 1.


Details:
1. initNetwork. We no longer assume even discretization of the space. The input to setInitialCon is now a struct with fields: IC, X_grid_cum.
2. changed the INDEX_UP and INDEX_DOWN to struct (linkStr).upstream; (linkStr).downstream
3. Added a samplePoint function which only compute the vehicle id at points.
4. Added extractDensity function, which can be used to extract the density estimate at certain time.
5. In postSolution. If t_interval is shorter than dt_tol, return the middle point as the approximated found intersection point.
6. Added several functions for extracting the traffic density at any time, including searchFuncSlope, searchShocksOnLine, extractDensity.
7. Added utility functions such as groupSameElement to class.
8. Debugged the current control toolbox is working for estimation.
9. Changed the variable names in setIneqConstraints to more intuitive names.
10. Added an errors structure which supports different levels of error for each type of measurement.
11. Enabled internal and density conditions
12. When converting min(s1, s2) to linear constraints by adding bools variables, we used C=500000 which we thought was large enough. Now we used inf directly.
13. Added clear description on internal and density conditions in setIneqConstraints class
14. Updated dv_index structure which now supports internal, density, and bool variables.

- Sep 22
15. AIMSUN ramp metering has different control parameters. The simplest way is to set the flow (veh/hr) and AIMSUN will automatically approximate it.
16. Wrote a simple unit conversion function between (miles/hr, veh/hr, veh/mile) — (kph, veh/hr, veh/km) — (m/s, veh/s, veh/m). All units used internally in MATLAB are (m/s, veh/s, veh/m) including the FD parameters. The data file are all in more readable forms (miles/hr, veh/hr, veh/mile).
17. AIMSUN API has been finished and debugged.

- Sep 24
18. Added the queue threshold in the onramp. But this works only for the problem without internal and density conditions
19. Wrote a short python file to process the historical data to desired format which can be read by MATLAB. The historical data was generated by AIMSUN which is the average of 10 replications.



- Oct 21
20. If no data, then MATLAB just auto discretizes the time and space, and then simulate.
21. updateDiscretization T_junc should contain the fixed boundary discretization in the past period and the updated boundary grid in the predicted period
20. Build a link index in setineqConstraints for better tracking the position of each decision variable.
21. Added a soft queue limit constraints assuming that we do not have internal or density conditions
22. Fixed a bug in previous version which sets the data constraints incorrectly (wrong indexing).
23. Fixed all the indexing in setIneqConstraints

- Oct 23
24. Constructed the objective function, so far the result looks reasonable.
25. Modified setIneqConstraints to use absolute error instead of relative error.
26. Modified maxOnrampFlow such that the weight of onramps flows is decreasing over steps and smaller than the smallest weight of upstream freeway.
27. Modified setWorkzoneCapacity, such that the capacity upper bound only applies to the flow in the future. The flow in the past is constrained by the measurement data.
28. Updated setSoftQueueLimit in setIneqConstraints.m, such that the soft queue limit is set only in the future time.

- Oct 24
29. All communication between MATLAB and AIMSUN are done in km and hr.
30. Added a function compareSignalandData to compare the desired flow value with the approximated flow value.


Todo:
- auto logging with time stamps
- Investigate a bit more on signal and if it is working as expected. It seems like the meter operates as: whenever a new flow signal is written to the meter, the meter let one car go and then wait a proper amount of time to approximate that flow. Need to find a way to resolve this. May change to use the red-green meter.
- write a replay function in AIMSUN so we can see the animation
- Write a function in MATLAB which plots the entire horizon using measurement data. (replay in MATLAB).
- Compare q1_ds + q2_ds with q3_us
- Check how much error AIMSUN detector has. Or how much error is in the fundamental diagram. Can we improve the result using a more accurate FD


Issues:
- The upper and lower bound for internal and density decision variables are set as -inf and inf. To investigate a little bit more to learn a realistic range.
- We have not defined an offramp actuator yet. We use a green red cycle ramp meter for onramp control.
- In find slope functions, if the interval is too small, the functions just return NaN which will introduce an error. Fix by computing an approximated slope.
- The queue threshold only works for problems without internal and density conditions. Otherwise we have to introduce boolean variables.
- The soft queue limit method holds only if there is not internal and density conditions. Otherwise, even if the point is not in the upstream influence domain, it still could be free flow since it might be in the domain of internal or density conditions.
- In coordination with AIMSUN, need to put a break point at the startcontrol function.
- The soft queue limit only applies in the current scenario, where a soft queue limit is only applied in the downstream link.
- The applyEntropy only supports on ramp junctions for now.
- currently plotting the hard queue and soft queue for visualization only works for the merge and onrampjunc.
